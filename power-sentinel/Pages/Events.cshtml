@page
@model PowerSentinel.Pages.EventsModel

<a href="/Statistic?deviceId=@Model.DeviceId">
@await Html.PartialAsync("_DeviceInfo", @Model.DeviceInfo)
</a>

<div class="space-y-2 mt-2">
  <header class="flex items-center justify-between">
    <div>
      <h2 class="text-xl font-semibold text-slate-800">Events</h2>
    </div>
    <div>
      <form method="get" class="flex items-center gap-2">
        <input type="hidden" name="deviceId" value="@Model.DeviceId" />
        <input type="date" name="date" value="@(Model.FilterDate.ToString("yyyy-MM-dd") ?? string.Empty)" class="border rounded px-2 py-1 text-sm" />
        <button class="px-3 py-1 bg-white border rounded text-sm">Filter</button>
      </form>
    </div>
  </header>

  <section>
    <div class="overflow-x-auto bg-white border rounded">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-50 text-slate-600">
          <tr>
            <th class="px-3 py-2 text-left">Event</th>
            <th class="px-3 py-2 text-left">Start</th>
            <th class="px-3 py-2 text-left">End</th>
            <th class="px-3 py-2 text-left">Duration</th>
          </tr>
        </thead>
        <tbody>
            @if (Model.DisplayEvents.Count == 0)
            {
              <tr><td class="p-4" colspan="4">No events</td></tr>
            }
          else
          {
              foreach (var evd in Model.DisplayEvents)
                  {
                  <tr class="border-t">
                    <td class="px-3 py-2">
                      @if (evd.IsPowerOn)
                      {
                        <span class="inline-flex items-center gap-1 bg-emerald-100 text-emerald-800 px-2 py-0.5 rounded text-xs font-medium">
                          <span class="w-2 h-2 rounded-full bg-emerald-600" aria-hidden="true"></span>
                          ON
                        </span>
                      }
                      else
                      {
                        <span class="inline-flex items-center gap-1 bg-red-100 text-red-800 px-2 py-0.5 rounded text-xs font-medium">
                          <span class="w-2 h-2 rounded-full bg-red-600" aria-hidden="true"></span>
                          OFF
                        </span>
                      }
                    </td>
                    <td class="px-3 py-2">@evd.DisplayStart.ToString("dd.MM.yyyy HH:mm")</td>
                    <td class="px-3 py-2">@(evd.DisplayEnd.HasValue ? evd.DisplayEnd.Value.ToString("dd.MM.yyyy HH:mm") : "â€”")</td>
                    <td class="px-3 py-2">
                      @(((int)evd.DisplayDuration.TotalHours).ToString("D2") + ":" + evd.DisplayDuration.Minutes.ToString("D2"))                          
                    </td>
                  </tr>
              }
          }
        </tbody>
      </table>
    </div>
  </section>
</div>
